<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DTDI Mineral Observation Map</title>

    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.1/handlebars.min.js"></script>

    <script src="facetview2/vendor/jquery/1.7.1/jquery-1.7.1.min.js"></script>
    <link rel="stylesheet" href="facetview2/vendor/bootstrap/css/bootstrap.min.css">
    <script type="text/javascript" src="facetview2/vendor/bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="facetview2/vendor/jquery-ui-1.8.18.custom/jquery-ui-1.8.18.custom.css">
    <script type="text/javascript" src="facetview2/vendor/jquery-ui-1.8.18.custom/jquery-ui-1.8.18.custom.min.js"></script>

    <script type="text/javascript" src="facetview2/es.js"></script>
    <script type="text/javascript" src="facetview2/bootstrap2.facetview.theme.js"></script>
    <script type="text/javascript" src="facetview2/jquery.facetview2.js"></script>
    <link rel="stylesheet" href="facetview2/css/facetview.css">

    <script id="mineral-observation-template" type="text/x-handlebars-template">
        <tr>
            <td>
                {{#if mineral-species.mineral-name-plain}}<div><strong>Mineral Name:</strong> <a href="{{mineral-species.mineral-mindat-url}}" target="_blank"> {{mineral-species.mineral-name-plain}}</a></div>
                {{else}} <div><strong>Mineral Name:</strong> N/A</div>
                {{/if}}

                {{#if locality}}
                <div> <strong>Locality: </strong><a href="{{locality.locality-mindat-url}}" target="_blank"> {{locality.locality-label}}</a></div>
                <div>
                    <strong>Longtitude:</strong>  {{locality.lon}}
                    <strong>Latitutde:</strong>  {{locality.lat}}
                    <a href="http://www.google.com/maps/place/{{locality.coordinates}}" target="_blank"> (View in Google Map)</a>
                </div>

                {{#if mineral-specimen.min-age}}
                <div>
                    <strong>Min Age:</strong> {{mineral-specimen.min-age}} Ma
                    {{#if mineral-specimen.label-1}}<sup>{{mineral-specimen.label-1}}</sup>{{/if}}
                    {{#if mineral-specimen.label-2}}<sup>{{mineral-specimen.label-2}}</sup>{{/if}}
                    {{#if mineral-specimen.label-3}}<sup>{{mineral-specimen.label-3}}</sup>{{/if}}
                </div>
                {{/if}}
                {{#if mineral-specimen.max-age}}
                <div>
                    <strong>Max Age:</strong> {{mineral-specimen.max-age}} Ma
                    {{#if mineral-specimen.label-1}}<sup>{{mineral-specimen.label-1}}</sup>{{/if}}
                    {{#if mineral-specimen.label-2}}<sup>{{mineral-specimen.label-2}}</sup>{{/if}}
                    {{#if mineral-specimen.label-3}}<sup>{{mineral-specimen.label-3}}</sup>{{/if}}
                </div>
                {{/if}}

                {{/if}}

                {{#if description}}<div><strong>Mineral Description:</strong> {{description}}</div>{{/if}}

                {{#if mineral-species.rruff-chemistry-html}}<div><strong>Mineral Chemistry:</strong> {{{mineral-species.rruff-chemistry-html}}}</div>{{/if}}

                {{!-- link to MINDAT profile (badge?) --}}
            </td>
        </tr>
    </script>

    <script type="text/javascript">

        Handlebars.registerHelper('expand', function(items, options) {
            var out = "";
            var j = items.length - 1;
            for(var i = 0; i < items.length; i++) {
                out += options.fn(items[i]);
                if(i < j) {
                    out += "; ";
                }
            }
            return out;
        });


        var source = $("#mineral-observation-template").html();
        var template = Handlebars.compile(source);
    </script>

    <script type="text/javascript">

        $(document).ready(function($) {
            $('.dtdi-map').facetview({
                search_url: 'http://localhost:9200/dtdi/mineral-observation/_search',
                page_size: 20,
                sharesave_link: true,
                search_button: true,
                default_freetext_fuzzify: "*",
                default_facet_operator: "AND",
                default_facet_order: "count",
                default_facet_size: 15,
                facets: [
                    {'field': 'mineral-species.mineral-name-plain.exact', 'display': 'Mineral Name'},
                    {'field': 'mineral-species.chemistry-elements-list.exact', 'display': 'Mineral Elements'},
                    {
                        'type' : 'range',
                        'field': 'mineral-specimen.min-age',
                        'display': 'Min Age',
                        'range': [
                            {'to': 100, 'display': '0 - 100 Ma'},
                            {'from': 100, 'to': 200, 'display': '100 - 200 Ma'},
                            {'from': 200, 'display': 'greater than 200 Ma'}
                        ],
                        'open': 'true'
                    },
                    {
                        'type' : 'range',
                        'field': 'mineral-specimen.max-age',
                        'display': 'Max Age',
                        'range': [
                            {'to': 100, 'display': '0 - 100 Ma'},
                            {'from': 100, 'to': 200, 'display': '100 - 200 Ma'},
                            {'from': 200, 'display': 'greater than 200 Ma'}
                        ],
                        'open': 'true'
                    },
                    {'field': 'locality.country.exact', 'display': 'Country'},
                    {'field': 'locality.region.exact', 'display': 'Region'},
                    {'field': 'locality.locality-label.exact', 'display': 'Locality'}
                ],
                render_result_record: function(options, record)
                {
                    // var html = "<tr><td>";
                    // html += "Hello World!";
                    return template(record).trim();
                },
                selected_filters_in_facet: true,
                show_filter_field : true,
                show_filter_logic: true
            });
        });
    </script>

    <style type="text/css">
        .direct_date {
        background: #BBFFBB;    /* light green */
        }
        .indirect_mineral_date {
        background: #DDFFFF;      /* light cyan */
        }

        .indirect_element_date {
        background: #FFFFAA;    /* light yellow */
        }
        .locality_date {
        background: #FFD088;    /* light orange */
        }
        .indirect_locality_date {
        background: #FFCCCC;    /* light red */
        }
        .shown_date {
        background: #55FF55; /* green */
        }
        .hidden_date {
        background: #FF5555;  /* red */
        }
        .row_no_display {
        display: none;
        }
        .date_no_display {
        display: none;
        }
    </style>

</head>
<body>
<div class="dtdi-map"></div>
<div>
    <table border="1" cellspacing="3">
        <tr>
            <td class="shown_date">&nbsp;&nbsp;&nbsp;</td>
            <td>
                This age satisfies at least one of these three conditions:</br>
                1) Mindat claims that this mineral occurs at this locality.</br>
                2) The locality containing the mineral has an age directly assigned to it.</br>
                3) This locality is displaying an age from a non-child locality.
            </td>
        </tr>
        <tr>
            <td class="hidden_date">&nbsp;&nbsp;&nbsp;</td>
            <td>This age does not satisfy any of the above conditions.</td>
        </tr>
    </table>
    </br>
    </br>
    <table border="1" cellspacing="3">
        <tr>
            <td class="direct_date">&nbsp;G&nbsp;</td>
            <td>This mineral is directly dated.</td>
        </tr>
        <tr>
            <td class="indirect_mineral_date">&nbsp;B&nbsp;</td>
            <td>This mineral is explicitely specified as having an age.</td>
        </tr>
        <tr>
            <td class="indirect_element_date">&nbsp;Y&nbsp;</td>
            <td>This mineral is using an age from a mineralization period.</td>
        </tr>
        <tr>
            <td class="locality_date">&nbsp;O&nbsp;</td>
            <td>This mineral is using an age calculated from all data at the locality.</td>
        </tr>
        <tr>
            <td class="indirect_locality_date">&nbsp;R&nbsp;</td>
            <td>The age displayed for this mineral is coming from a different, non-child locality.</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>This mineral is not associated with an age.</td>
        </tr>
    </table>
</div>
</body>
</html>